<!DOCTYPE html>
<html>

<head>
  <title>圖片上傳</title>
  <style>
    .input-container {
      width: 300px;
      /* 設定初始寬度 */
      border: 1px solid #ccc;
      overflow-x: auto;
      /* 超過寬度時顯示水平拉條 */
      overflow-y: hidden;
      /* 初始隱藏垂直拉條 */
      resize: vertical;
      /* 允許垂直調整大小 */
    }

    .scrollable-input {
      width: 100%;
      border: none;
      outline: none;
      resize: none;
      /* 禁止使用者調整大小 */
      overflow: hidden;
      /* 隱藏內部垂直拉條 */
      box-sizing: border-box;
      /* 包含 padding 和 border 在寬度計算中 */
      font-size: 16px;
      padding: 5px;
    }
  </style>
</head>

<body>
  <h1>圖片上傳</h1>
  <div class="input-container">
    <textarea class="scrollable-input" id="myInput"></textarea>
  </div>
  
  <input type="file" id="fileInput" accept="image/*">
  <button id="uploadButton" disabled>上傳</button>
  <button id="downloadTemplate">下載樣板</button>

  <!-- <div class="input-container">
    <input type="text" class="scrollable-input" value="這是一個很長的文字，超過input寬度時會出現拉條。">
  </div> -->


  <script>
    const input = document.getElementById('myInput');

    input.addEventListener('input', function () {
      this.style.height = 'auto'; // 先重置高度
      this.style.height = (this.scrollHeight) + 'px'; // 根據內容調整高度
    });
  </script>

  <script>
    const max = 2048;
    const maxWidth = 1000;
    const maxHeight = 1000;
    const fileInput = document.getElementById('fileInput');
    const uploadButton = document.getElementById('uploadButton');

    fileInput.addEventListener('change', handleFileSelect);

    document.getElementById('downloadTemplate').addEventListener('click', function () {
      // const imageUrl = '你的圖片網址.jpg'; // 替換成你的圖片網址
      const imageUrl = "./static/pictures/filletsteak_cloth_template.png";
      const imageName = 'filletsteak_cloth_template.png'; // 設定下載檔案名稱

      const a = document.createElement('a');
      a.href = imageUrl;
      a.download = imageName; // 設定下載檔案名稱
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    });

    function handleFileSelect(event) {
      const file = event.target.files[0];

      if (!file) {
        return;
      }

      // 檢查檔案大小 (單位：bytes)
      const maxSize = 1 * max * max; // 1MB
      if (file.size > maxSize) {
        alert(`圖片大小超過限制 (${maxSize / 1024}MB)`);
        uploadButton.disabled = true;
        return;
      }

      // 檢查圖片尺寸
      const img = new Image();
      img.onload = function () {
        if (img.width > maxWidth || img.height > maxHeight) {
          alert(`圖片尺寸超過限制 (${maxWidth}x${maxHeight})`);
          uploadButton.disabled = true;
        } else {
          uploadButton.disabled = false;
        }
      };
      img.src = URL.createObjectURL(file);
    }

    uploadButton.addEventListener('click', uploadFile);

    function uploadFile() {
      const file = fileInput.files[0];
      const formData = new FormData();
      formData.append('file', file);
      // http://127.0.0.1:8085/upload
      // http://ehci.meyselfnas.com:8085/upload
      fetch('https://ehci.direct.quickconnect.to:8085/upload_api', { // 替換成你的上傳 API
        method: 'POST',
        body: formData
      })
        .then(response => {
          if (response.ok) {
            alert('上傳成功！');
            // 顯示圖片
            // const img = document.createElement('img');
            // img.src = URL.createObjectURL(file);
            // document.body.appendChild(img); // 將圖片添加到網頁中
          } else {
            alert('上傳失敗！');
          }
        })
        .catch(error => {
          console.error('上傳錯誤:', error);
          alert(`上傳發生錯誤！${error}`);
        });
    }
  </script>
</body>

</html>